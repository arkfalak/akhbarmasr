<!DOCTYPE html>
<html>
<head>
    <title>أخبار مصر</title>
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        .item {
            display: flex;
            margin-bottom: 20px;
        }
        .item img {
            width: 100px;
            height: 100px;
            margin-right: 10px;
        }
        .item .content {
            flex: 1;
        }
    </style>
</head>
<body>
    <div id="items"></div>
    <div id="pagination"></div>
    <script>
        // Fetch the JSON data
        fetch('https://simplenews-bbb17-default-rtdb.europe-west1.firebasedatabase.app/arabshorts/xmls.json')
            .then(response => response.json())
            .then(data => {
                // Get the items array from the JSON data
                const items = Object.values(data)[5]?.rss?.channel?.item; // Extract the first key's value

                // Get the "items" div where the content will be displayed
                const itemsContainer = document.getElementById('items');
                // Get the "pagination" div for pagination controls
                const paginationContainer = document.getElementById('pagination');

                // Define pagination variables
                const itemsPerPage = 5; // Number of items to display per page
                let currentPage = 1;

                // Check if items array exists
                if (Array.isArray(items)) {
                    // Calculate the starting and ending indices for the current page
                    const startIndex = (currentPage - 1) * itemsPerPage;
                    const endIndex = startIndex + itemsPerPage;
                    const currentItems = items.slice(startIndex, endIndex);

                    // Display the current page of items
                    displayItems(currentItems);

                    // Render pagination controls
                    renderPagination();

                    // Function to display items
                    function displayItems(items) {
                        // Clear the items container
                        itemsContainer.innerHTML = '';

                        // Loop through each item and extract the necessary properties
                        items.forEach(item => {
                            const title = item.title?._t;
                            const pubdate = item.pubDate?._t;
                            let description = item.description?._t;
                            if (!description) {
                                description = item.description?._cd;
                            }
                            const link = item.link?._t;
                            let image = item.enclosure?.url;

                            if (!image) {
                                // Make an HTTP request to the link
                                fetch(link)
                                    .then(response => response.text())
                                    .then(html => {
                                        // Extract the image thumbnail from the HTML response
                                        const parser = new DOMParser();
                                        const doc = parser.parseFromString(html, "text/html");
                                        const imgElement = doc.querySelector("img");

                                        if (imgElement) {
                                            image = imgElement.src;
                                            // Use the image URL here or assign it to a variable
                                        } else {
                                            // Handle the case where no image thumbnail is found
                                            console.log("No image thumbnail found.");
                                        }
                                    })
                                    .catch(error => {
                                        // Handle any error that occurs during the HTTP request
                                        console.log("Error fetching image thumbnail:", error);
                                    });
                            } else {
                                // Use the existing image URL
                            }

                            // Create the HTML elements to display the item
                            const itemElement = document.createElement('div');
                            itemElement.className = 'item';

                            const imageElement = document.createElement('img');
                            imageElement.src = image;

                            const contentElement = document.createElement('div');
                            contentElement.className = 'content';

                            const titleElement = document.createElement('h2');
                            titleElement.textContent = title;

                            const descriptionElement = document.createElement('p');
                            const sanitizedContent = description.replace(/<img\b[^>]*>/gi, '');
                            descriptionElement.innerHTML = sanitizedContent;

                            const linkElement = document.createElement('a');
                            linkElement.href = link;
                            linkElement.target = "_blank";
                            linkElement.textContent = 'Read More';

                            // Append the elements to the container
                            contentElement.appendChild(titleElement);
                            contentElement.appendChild(descriptionElement);
                            contentElement.appendChild(linkElement);

                            itemElement.appendChild(imageElement);
                            itemElement.appendChild(contentElement);

                            itemsContainer.appendChild(itemElement);
                        });
                    }

                    // Function to render pagination controls
                    function renderPagination() {
                        // Clear the pagination container
                        paginationContainer.innerHTML = '';

                        // Calculate the total number of pages
                        const totalPages = Math.ceil(items.length / itemsPerPage);

                        // Create previous page button
                        if (currentPage > 1) {
                            const prevButton = createPaginationButton('Previous', currentPage - 1);
                            paginationContainer.appendChild(prevButton);
                        }

                        // Create page number buttons
                        for (let i = 1; i <= totalPages; i++) {
                            const pageButton = createPaginationButton(i, i);
                            paginationContainer.appendChild(pageButton);
                        }

                        // Create next page button
                        if (currentPage < totalPages) {
                            const nextButton = createPaginationButton('Next', currentPage + 1);
                            paginationContainer.appendChild(nextButton);
                        }
                    }

                    // Function to create a pagination button
                    function createPaginationButton(text, page) {
                        const button = document.createElement('button');
                        button.textContent = text;

                        // Add event listener to handle page navigation
                        button.addEventListener('click', () => {
                            currentPage = page;
                            // Calculate the starting and ending indices for the current page
                            const startIndex = (currentPage - 1) * itemsPerPage;
                            const endIndex = startIndex + itemsPerPage;
                            const currentItems = items.slice(startIndex, endIndex);

                            // Display the current page of items
                            displayItems(currentItems);

                            // Render pagination controls
                            renderPagination();
                        });

                        return button;
                    }
                } else {
                    console.error('Invalid JSON structure');
                }
            })
            .catch(error => console.error('Error:', error));
    </script>
</body>
</html>
